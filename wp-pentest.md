# **Ethical WordPress Pentest: Linux Command Cheat Sheet for Students (Docker Sandbox Only)**

**Purpose**: This cheat sheet is for cybersecurity students to practice ethical pentesting in a sandbox environment for research and learning. Never use on live systems without explicit permission. Published for education and research purposes only.

**Sandbox Setup**:
```bash
# Run a local WordPress instance via Docker
docker run -d -p 8080:80 wordpress
# Access at http://localhost:8080
```

Optional: mount a volume to persist changes for practice:

```bash
docker run -d -p 8080:80 -v $(pwd)/wp-data:/var/www/html wordpress
```
---

## **0. Tool Installation (Prepare Your Environment)**

* **Objective**: Install necessary tools for pentesting.
* **Commands**:

```bash
# Update system and install common tools
sudo apt update && sudo apt install -y curl nmap dirb gobuster whatweb sslyze testssl.sh

# Install WPScan (requires Ruby)
sudo apt install -y ruby ruby-dev
gem install wpscan

or

sudo apt install wpscan


# Install sqlmap for injection testing (lab-only)
sudo apt install -y sqlmap

# Install droopescan (lightweight WordPress scanner)
pip install droopescan

# Install OWASP ZAP CLI
sudo apt install -y zaproxy
```

* **Notes**:
  - Run `wpscan --update` to update the WPScan vulnerability database.
  - Ensure Docker is installed (`sudo apt install docker.io`).

---

## **1. Network Reconnaissance**

* **Objective**: Understand the server environment hosting WordPress.
* **Commands**:

```bash
# Basic port scanning to identify services
nmap -sV -p 80,443 localhost  # Replace localhost with sandbox IP

# Check for hidden services or non-standard ports
nmap -sS -p- localhost  # Stealth scan for all ports

# Fingerprint server OS and services
sudo nmap -O localhost
```

* **Notes**:
  - Look for open ports (e.g., 80, 443, 3306 for MySQL).
  - Identify server software (e.g., Apache, Nginx) for potential misconfigurations.
  - **Why?**: Understanding the network context helps identify attack surfaces.

---

## **2. Platform Reconnaissance**

* **Objective**: Confirm WordPress usage and gather version details.
* **Commands**:

```bash
# Check HTTP headers for server/CMS clues
curl -s -I http://localhost:8080 | grep -i "server\|x-powered-by\|wp"

# Verify WordPress paths
curl -s -I http://localhost:8080/wp-login.php | grep "200 OK"
curl -s -I http://localhost:8080/wp-admin/ | grep "200 OK"

# Fingerprint CMS with WhatWeb
whatweb -v http://localhost:8080

# Enumerate users, plugins, themes with WPScan
wpscan --url http://localhost:8080 --enumerate u,p,t --no-banner --random-user-agent
```

* **Notes**:
  - Check for version leaks in `readme.html` or `/wp-includes/version.php`.
  - Use `--random-user-agent` to mimic legitimate traffic.
  - **Student Task**: Note down detected versions and research CVEs.

---

## **3. Directory and File Exposure**

* **Objective**: Find exposed sensitive files or directories.
* **Commands**:

```bash
# Check for common sensitive files
for file in .env wp-config.php wp-config.php.bak readme.html; do
  curl -s -I http://localhost:8080/$file | grep "200 OK" && echo "Found: $file"
done

# Directory brute-forcing (lightweight, lab-only)
gobuster dir -u http://localhost:8080 -w /usr/share/wordlists/dirb/common.txt -q -t 10

# Check for directory listing
curl -s http://localhost:8080/wp-content/uploads/ | grep -i "index of"
```

* **Notes**:
  - Use a loop for efficiency when checking multiple files.
  - Replace `/usr/share/wordlists/dirb/common.txt` with `rockyou.txt` for broader tests (lab-only).
  - **Student Task**: Discuss risks of exposed `wp-config.php` (e.g., DB credentials leak).

---

## **4. Plugin and Theme Enumeration**

* **Objective**: Identify vulnerable plugins/themes.
* **Commands**:

```bash
# Enumerate vulnerable plugins/themes
wpscan --url http://localhost:8080 --enumerate vp,vt --no-banner

# Check plugin/theme versions manually
curl -s http://localhost:8080/wp-content/plugins/[plugin-name]/readme.txt | grep -i "version"
curl -s http://localhost:8080/wp-content/themes/[theme-name]/style.css | grep -i "version"

# Lightweight alternative with droopescan
droopescan scan wordpress -u http://localhost:8080
```

* **Notes**:
  - Cross-reference findings with `exploit-db` or WPScan‚Äôs vulnerability DB.
  - **Student Task**: Search for a plugin‚Äôs CVE and simulate an exploit in the sandbox.

---

## **5. Authentication and Access Checks**

* **Objective**: Analyze login mechanisms and potential weaknesses.
* **Commands**:

```bash
# Verify login page and XML-RPC accessibility
curl -s -I http://localhost:8080/wp-login.php | grep "200 OK"
curl -s -I http://localhost:8080/xmlrpc.php | grep "200 OK"

# Test XML-RPC methods (lab-only)
curl -s -X POST http://localhost:8080/xmlrpc.php -d '<?xml version="1.0"?><methodCall><methodName>system.listMethods</methodName></methodCall>' | grep -i "methodname"
```

* **Notes**:
  - XML-RPC can enable brute-force or DDoS attacks if not disabled.
  - **Student Task**: Check if the sandbox has rate-limiting or CAPTCHA (inspect response headers).

---

## **6. Configuration & Permissions Review**

* **Objective**: Identify server-side misconfigurations (local access required).
* **Commands**:

```bash
# List permissions in web root
find /var/www/html -type f -exec ls -l {} \; | grep -E "\.php|\.conf"
find /var/www/html -type d -exec ls -ld {} \;

# Find overly permissive files
find /var/www/html -perm -o+w -exec ls -l {} \;  # World-writable
find /var/www/html -perm -o+r -name "*.php"  # Readable PHP files

# Check file ownership
find /var/www/html ! -user www-data -exec ls -l {} \;

# Inspect sensitive files
cat /var/www/html/wp-config.php | grep -i "DB_\|key\|salt"
curl -s http://localhost:8080/robots.txt
cat /var/www/html/.htaccess
```

* **Notes**:
  - `find /var/www/html -perm -o+r -name "*.php"` lists world-readable PHP, which is usually less critical than world-writable. Writable files (-perm -o+w) are the real risk.
  - Ensure `wp-config.php` has `640` permissions (`chmod 640 wp-config.php`).
  - **Student Task**: Modify `.htaccess` to deny access to `wp-config.php` and test.

---

## **7. Writable Files and Upload Risks**

* **Objective**: Identify writable directories exploitable via uploads.
* **Commands**:

```bash
# Find writable files by web server user
find /var/www/html -user www-data -type f -perm -u+w

# Check upload directory permissions
find /var/www/html/wp-content/uploads -type d -perm -o+w

# Test file upload (lab-only, manual)
curl -s -X POST -F "file=@/tmp/test.txt" http://localhost:8080/wp-content/uploads/ | grep -i "success"
```

* **Notes**:
  - Writable `wp-content/uploads` can allow malicious file uploads.
  - **Student Task**: Upload a benign file (e.g., `test.txt`) and check if it‚Äôs accessible.

---

## **8. Input Validation / Injection Testing (Lab Only)**

* **Objective**: Practice finding XSS, SQLi, or other vulnerabilities safely.
* **Commands**:

```bash
# Test for reflected XSS in search forms
curl -s "http://localhost:8080/?s=<script>alert(1)</script>" | grep -i "<script>"

# Test SQL injection with sqlmap (lab-only)
sqlmap -u "http://localhost:8080/?p=1" --batch --level=1 --dbs

# Automated scanning with OWASP ZAP
zap-cli quick-scan --self-contained http://localhost:8080
```

* **Notes**:
  - Focus on forms, comments, or REST API endpoints (`/wp-json/`).
  - Lab-only, never against live servers.
  - **Student Task**: Craft a safe XSS payload and verify if it executes in the sandbox.

---

## **9. Security Headers & TLS**

* **Objective**: Evaluate HTTP headers and SSL/TLS security.
* **Commands**:

```bash
# Check security headers
curl -s -I http://localhost:8080 | grep -i "x-frame-options\|content-security-policy\|strict-transport-security"

# Analyze TLS configuration
testssl.sh --quiet http://localhost:8080
sslyze --regular http://localhost:8080 | grep -i "cipher\|vulnerable"

# Use Mozilla Observatory for header analysis
observatory-cli http://localhost:8080
```

* **Notes**:
  - Look for missing `X-Content-Type-Options: nosniff` or weak TLS ciphers.
  - **Student Task**: Add HSTS to the sandbox‚Äôs `.htaccess` and retest.

---

## **10. Log Analysis**

* **Objective**: Understand how actions are logged for ethical awareness.
* **Commands**:

```bash
# Check Apache/Nginx access logs
tail -n 50 /var/log/apache2/access.log  # or /var/log/nginx/access.log
grep "wp-login" /var/log/apache2/access.log

# Check WordPress audit logs (if plugin installed, e.g., WP Security Audit Log)
docker exec -it <container_id> cat /var/www/html/wp-content/uploads/wp-security-audit-log.log
```

* **Notes**:
  - Logs reveal your testing footprint (IP, user-agent, endpoints accessed).
  - **Student Task**: Correlate your `curl` commands with log entries.

---

## **11. Remediation Practice**

* **Objective**: Learn to fix vulnerabilities in the sandbox.
* **Commands**:

```bash
# Update WordPress core, plugins, themes
docker exec -it <container_id> wp core update
docker exec -it <container_id> wp plugin update --all
docker exec -it <container_id> wp theme update --all

# Harden file permissions
chmod 640 /var/www/html/wp-config.php
chmod -R 755 /var/www/html/wp-content/uploads

# Disable XML-RPC in wp-config.php
echo "define('XMLRPC_ENABLED', false);" >> /var/www/html/wp-config.php

# Add security headers to .htaccess
cat <<EOT >> /var/www/html/.htaccess
Header set X-Frame-Options "DENY"
Header set X-Content-Type-Options "nosniff"
Header set Strict-Transport-Security "max-age=31536000"
EOT
```

* **Notes**:
  - Requires `wp-cli` in the Docker container (`docker exec -it <container_id> apt install wp-cli`).
  - Students should observe 403 or 405 responses as normal if disabled.
  - older WordPress may require plugin for complete XML-RPC disable.
  - **Student Task**: Retest after applying fixes to confirm vulnerabilities are resolved.

---

## **12. Reporting**

* **Objective**: Document findings for professional reporting.
* **Commands**:

```bash
# Save command outputs
wpscan --url http://localhost:8080 --enumerate vp | tee wpscan_report.txt
curl -s -I http://localhost:8080 | tee headers.txt

# Take screenshots (GUI environment)
scrot screenshot.png

# Generate a PDF report
pandoc report.md -o report.pdf
```

* **Guidelines**:
  - Include:
    - Vulnerability details (e.g., plugin CVE, exposed files).
    - Command outputs and screenshots.
    - CVSS scores (use `cve.mitre.org` for reference).
    - Remediation steps applied.
  - **Student Task**: Draft a sample report with findings and fixes.

---

## **13. Cleanup**

* **Objective**: Reset the sandbox to avoid lingering issues.
* **Commands**:

```bash
# Remove test files
rm /var/www/html/wp-content/uploads/test.txt

# Reset Docker container
docker stop <container_id> && docker rm <container_id>
docker run -d -p 8080:80 wordpress
```

* **Notes**:
  - Always clean up to prevent accidental vulnerabilities.
  - **Student Task**: Verify cleanup by re-running scans.

---

## **üí° Student Tips**

* **Passive First**: Start with `curl` and `whatweb` to minimize detection.
* **Automate Repetition**: Create a simple Bash script for repetitive tasks:
  ```bash
  #!/bin/bash
  TARGET="http://localhost:8080"
  curl -s -I $TARGET/wp-login.php | grep "200 OK" && echo "Login page found"
  wpscan --url $TARGET --enumerate vp --no-banner | tee scan.txt
  ```
* **Learn Defense**: Apply fixes (e.g., permissions, headers) and retest.
* **Ethical Mindset**: Always assume your actions are logged; practice transparency.
* **Resources**:
  - WPScan DB: `https://wpscan.com/api`
  - Exploit-DB: `https://www.exploit-db.com`
  - OWASP Top 10: `https://owasp.org/www-project-top-ten/`

---

## **Additional Suggestions for Students**

1. **REST API Testing**:
   - WordPress‚Äôs REST API (`/wp-json/`) can leak user data or allow unauthorized access.
   - Command:
     ```bash
     curl -s http://localhost:8080/wp-json/wp/v2/users | jq .
     ```
   - **Task**: Check if user enumeration is possible and disable via `wp-config.php`.

2. **Simulate Real Attacks**:
   - Use Metasploit in the sandbox to simulate a plugin exploit (e.g., CVE-2021-12345).
   - Note, Metasploit can be illegal against external sites.
     ```bash
     msfconsole -q
     use exploit/multi/http/wp_plugin_x
     set RHOSTS localhost
     set RPORT 8080
     run
     ```
   - **Task**: Document the exploit process and mitigation.

3. **Log Analysis Exercise**:
   - Correlate your scans with server logs to understand detection mechanisms.
   - **Task**: Identify which commands triggered log entries.

4. **Group Projects**:
   - Divide students into ‚Äúattack‚Äù and ‚Äúdefense‚Äù teams. Attackers use the cheat sheet; defenders harden the sandbox and monitor logs.

5. **Interactive Learning**:
   - Use `tmux` or `screen` to demonstrate live pentesting to students:
     ```bash
     tmux new -s pentest
     ```
   - Split panes to show commands, outputs, and logs simultaneously.

---

Yes, it‚Äôs very useful to mention what a typical `.env` file contains‚Äîespecially for students‚Äîbecause it helps them **understand why exposing it is a critical risk**. You don‚Äôt need to give real credentials; just explain the kinds of variables that are usually stored there.

---

### **Typical contents of a WordPress `.env` file**

```text
DB_NAME=wordpress_db          # Database name
DB_USER=wordpress_user        # Database username
DB_PASSWORD=supersecret       # Database password
DB_HOST=localhost             # Database host (e.g., localhost)
WP_HOME=http://localhost:8080 # Site URL
WP_SITEURL=http://localhost:8080/wp
AUTH_KEY=some-random-string   # Authentication salts
SECURE_AUTH_KEY=another-string
LOGGED_IN_KEY=another-string
NONCE_KEY=another-string
AUTH_SALT=another-string
SECURE_AUTH_SALT=another-string
LOGGED_IN_SALT=another-string
NONCE_SALT=another-string
```

---

1. **Database credentials**: If exposed, an attacker could read or modify the database.
2. **Site configuration**: URLs and host info can reveal the structure of the WordPress installation.
3. **Authentication keys/salts**: Critical for session security; leaking them can allow cookie hijacking.

Sysadmins should always ensure `.env` is not accessible via HTTP (`chmod 600` or outside web root) and never commit it to version control.

---

### **Why malware attached to a WordPress site is dangerous**

1. **Dynamic content + user trust**

   * Media websites and popular blogs are visited by thousands of readers every day.
   * If attackers modifies the website to inject malware into articles, anyone who loads that page could be infected.

2. **Types of malware commonly injected**

   * **Drive-by downloads**: automatic download of malicious files when someone visits the page.
   * **Cryptojacking scripts**: hidden JavaScript that mines cryptocurrency using visitors‚Äô CPU.
   * **Phishing forms**: fake login prompts to steal credentials.
   * **SEO spam / spam content injection**: attackers inject spam links to boost their own sites‚Äô SEO.

3. **Consequences**

   * **Reputation damage**: readers lose trust in the site.
   * **Legal liability**: if user computers get infected, the site owner could be partially liable.
   * **Search engine penalties**: Google and others can blacklist the site.
   * **Propagation**: malware could spread to users‚Äô networks, amplifying damage.

4. **Why WordPress is often targeted**

   * PHP + database = writable, dynamic system.
   * Plugins/themes often have vulnerabilities.
   * Admin credentials, if weak, allow attackers to execute scripts directly.

---

### **Key takeaway**

* Static sites (Hugo, Jekyll, Eleventy) drastically reduce attack surface.
* WordPress or any dynamic CMS requires continuous patching, monitoring, and strict access control.
* Malware injection in a dynamic CMS can instantly affect thousands of visitors.
* Contact professionals at https://kibervarnost.si to make your blog or media website safe.

